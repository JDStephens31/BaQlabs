<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Backtesting Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    'sans': ['Inter', 'sans-serif'],
                    'mono': ['JetBrains Mono', 'monospace']
                },
                colors: {
                    gray: {
                        850: '#262626',
                        750: '#404040'
                    }
                }
            }
        }
    };
    </script>
    <style>
        .syntax-keyword { color: #000; font-weight: 600; }
        .syntax-string { color: #404040; }
        .syntax-comment { color: #737373; font-style: italic; }
        .pattern-diagonal {
            background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, #e5e5e5 2px, #e5e5e5 4px);
        }
        .chart-line {
            stroke: #000;
            stroke-width: 2;
            fill: none;
        }
        .chart-area {
            fill: url(#diagonalHatch);
        }
        .hover-opacity:hover {
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-sm text-gray-850 overflow-hidden">
    <!-- @COMPONENT: TopBar [project controls, dataset selector, run buttons] -->
    <div class="bg-white border-b border-gray-300 px-4 py-2 flex items-center justify-between">
        <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
                <span class="font-semibold">Project:</span>
                <select class="border border-gray-300 px-2 py-1 text-sm bg-white hover-opacity">
                    <option>Momentum Strategy v2.1</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="font-medium">Dataset:</span>
                <select class="border border-gray-300 px-2 py-1 text-sm bg-white hover-opacity">
                    <option>NQ 2025-08 (5 days)</option>
                </select>
            </div>
            <div class="flex items-center space-x-2">
                <span class="font-medium">Symbol:</span>
                <span class="font-mono font-semibold">NQH25</span>
            </div>
            <div class="flex items-center space-x-2">
                <span class="font-medium">Session:</span>
                <span class="font-mono">06:00-15:30 PST</span>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <button class="px-4 py-1 border border-gray-400 bg-white hover-opacity text-sm font-medium">1-Day Smoke Test</button>
            <button class="px-4 py-1 bg-black text-white hover-opacity text-sm font-medium">Run Full Backtest</button>
            <button class="px-2 py-1 border border-gray-300 hover-opacity">⏸</button>
            <button class="px-2 py-1 border border-gray-300 hover-opacity">⏹</button>
        </div>
    </div>
    <!-- @END_COMPONENT: TopBar -->

    <div class="flex h-[calc(100vh-49px)]">
        <!-- @COMPONENT: LeftSidebar [navigation tree, datasets, strategies] -->
        <div class="w-64 bg-white border-r border-gray-300 flex flex-col">
            <div class="p-3 border-b border-gray-200">
                <h3 class="font-semibold text-gray-900">Navigator</h3>
            </div>
            <div class="flex-1 overflow-y-auto">
                <div class="p-2">
                    <div class="mb-4">
                        <div class="font-medium text-gray-900 mb-2 flex items-center">
                            <span class="mr-1">▼</span> Datasets
                        </div>
                        <div class="ml-4 space-y-1">
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm">NQ 2025-08 (5 days)</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">ES 2025-07 (10 days)</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">RTY 2025-06 (3 days)</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="font-medium text-gray-900 mb-2 flex items-center">
                            <span class="mr-1">▼</span> Strategies
                        </div>
                        <div class="ml-4 space-y-1">
                            <div class="py-1 px-2 bg-gray-100 cursor-pointer text-sm font-medium">Maker Queue Aware</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">Mean Reversion v3</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">Momentum Breakout</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="font-medium text-gray-900 mb-2 flex items-center">
                            <span class="mr-1">▼</span> Models
                        </div>
                        <div class="ml-4 space-y-1">
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm">XGBoost Classifier</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">LSTM Predictor</div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="font-medium text-gray-900 mb-2 flex items-center">
                            <span class="mr-1">▼</span> Experiments
                        </div>
                        <div class="ml-4 space-y-1">
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm">Run_2025_01_15_14:23</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">Run_2025_01_15_09:45</div>
                        </div>
                    </div>
                    <div>
                        <div class="font-medium text-gray-900 mb-2 flex items-center">
                            <span class="mr-1">▼</span> Reports
                        </div>
                        <div class="ml-4 space-y-1">
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm">Performance Summary</div>
                            <div class="py-1 px-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600">Risk Attribution</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: LeftSidebar -->

        <!-- @COMPONENT: MainContent [tabbed interface with strategy, mbo, results] -->
        <div class="flex-1 flex flex-col">
            <!-- Tab Navigation -->
            <div class="bg-white border-b border-gray-300 flex">
                <button class="px-4 py-2 border-r border-gray-300 bg-gray-100 font-medium text-sm">STRATEGY</button>
                <button class="px-4 py-2 border-r border-gray-300 hover:bg-gray-50 font-medium text-sm text-gray-600">MBO REPLAY</button>
                <button class="px-4 py-2 border-r border-gray-300 hover:bg-gray-50 font-medium text-sm text-gray-600">RESULTS</button>
                <button class="px-4 py-2 border-r border-gray-300 hover:bg-gray-50 font-medium text-sm text-gray-600">QUEUE</button>
                <button class="px-4 py-2 border-r border-gray-300 hover:bg-gray-50 font-medium text-sm text-gray-600">LATENCY LAB</button>
                <button class="px-4 py-2 hover:bg-gray-50 font-medium text-sm text-gray-600">MODEL LAB</button>
            </div>

            <!-- Strategy Tab Content -->
            <div class="flex-1 flex">
                <!-- Code Editor Panel -->
                <div class="flex-1 bg-white border-r border-gray-300">
                    <div class="p-3 border-b border-gray-200 bg-gray-50">
                        <h4 class="font-semibold">Strategy Code Editor</h4>
                    </div>
                    <div class="p-4 font-mono text-sm leading-relaxed">
                        <div class="space-y-1">
                            <div><span class="syntax-comment">// Strategy: Maker Queue Aware</span></div>
                            <div><span class="syntax-comment">// Author: Trading Team</span></div>
                            <div><span class="syntax-comment">// Last Modified: 2025-01-15 14:23 PST</span></div>
                            <div></div>
                            <div><span class="syntax-keyword">function</span> onMarketData(book, trades) {</div>
                            <div class="ml-4"><span class="syntax-keyword">const</span> imbalance = calculateImbalance(book);</div>
                            <div class="ml-4"><span class="syntax-keyword">const</span> churnRising = isChurnRising(trades);</div>
                            <div></div>
                            <div class="ml-4"><span class="syntax-keyword">if</span> (imbalance > <span class="syntax-string">0.6</span> && churnRising) {</div>
                            <div class="ml-8">joinBid(book.bestBid, <span class="syntax-string">1</span>);</div>
                            <div class="ml-4">} <span class="syntax-keyword">else if</span> (imbalance < <span class="syntax-string">-0.6</span> && churnRising) {</div>
                            <div class="ml-8">joinAsk(book.bestAsk, <span class="syntax-string">1</span>);</div>
                            <div class="ml-4">}</div>
                            <div></div>
                            <div class="ml-4"><span class="syntax-comment">// Risk management</span></div>
                            <div class="ml-4"><span class="syntax-keyword">if</span> (getPosition() > maxPosition) {</div>
                            <div class="ml-8">reducePosition();</div>
                            <div class="ml-4">}</div>
                            <div>}</div>
                            <div></div>
                            <div><span class="syntax-keyword">function</span> calculateImbalance(book) {</div>
                            <div class="ml-4"><span class="syntax-keyword">const</span> bidSize = book.bids.reduce((sum, level) => sum + level.size, <span class="syntax-string">0</span>);</div>
                            <div class="ml-4"><span class="syntax-keyword">const</span> askSize = book.asks.reduce((sum, level) => sum + level.size, <span class="syntax-string">0</span>);</div>
                            <div class="ml-4"><span class="syntax-keyword">return</span> (bidSize - askSize) / (bidSize + askSize);</div>
                            <div>}</div>
                        </div>
                    </div>
                </div>

                <!-- Parameters Panel -->
                <div class="w-80 bg-white">
                    <div class="p-3 border-b border-gray-200 bg-gray-50">
                        <h4 class="font-semibold">Strategy Parameters</h4>
                    </div>
                    <div class="p-4 space-y-4">
                        <div>
                            <label class="block font-medium mb-1">Time Window</label>
                            <div class="flex space-x-2">
                                <input type="time" value="06:00" class="border border-gray-300 px-2 py-1 text-sm flex-1">
                                <span class="self-center">–</span>
                                <input type="time" value="15:30" class="border border-gray-300 px-2 py-1 text-sm flex-1">
                            </div>
                            <div class="text-xs text-gray-600 mt-1">PST timezone</div>
                        </div>

                        <div>
                            <label class="block font-medium mb-1">Trading Fees</label>
                            <div class="flex items-center space-x-2">
                                <input type="number" value="0.45" step="0.01" class="border border-gray-300 px-2 py-1 text-sm w-20">
                                <span class="text-sm">bps</span>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium mb-1">Tick Size</label>
                                <input type="number" value="0.25" step="0.01" class="border border-gray-300 px-2 py-1 text-sm w-full">
                            </div>
                            <div>
                                <label class="block font-medium mb-1">Lot Size</label>
                                <input type="number" value="1" class="border border-gray-300 px-2 py-1 text-sm w-full">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block font-medium mb-1">Take Profit</label>
                                <input type="number" value="8" class="border border-gray-300 px-2 py-1 text-sm w-full">
                            </div>
                            <div>
                                <label class="block font-medium mb-1">Stop Loss</label>
                                <input type="number" value="6" class="border border-gray-300 px-2 py-1 text-sm w-full">
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" checked class="w-4 h-4">
                                <label class="font-medium">Use Market-by-Order Data</label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" checked class="w-4 h-4">
                                <label class="font-medium">Simulate Latency</label>
                            </div>
                        </div>

                        <div class="border-t pt-4">
                            <label class="block font-medium mb-2">Latency Profile</label>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span>Distribution:</span>
                                    <span class="font-mono">Gaussian</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Mean:</span>
                                    <span class="font-mono">10 ms</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Std Dev:</span>
                                    <span class="font-mono">±3 ms</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Burst Events:</span>
                                    <span class="font-mono">5% @ 30-80ms</span>
                                </div>
                            </div>
                        </div>

                        <div class="border-t pt-4">
                            <label class="block font-medium mb-2">Position Limits</label>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Max Long</label>
                                    <input type="number" value="10" class="border border-gray-300 px-2 py-1 text-sm w-full">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Max Short</label>
                                    <input type="number" value="-10" class="border border-gray-300 px-2 py-1 text-sm w-full">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: MainContent -->

        <!-- @COMPONENT: RightInspector [context config, trade details, risk settings] -->
        <div class="w-72 bg-white border-l border-gray-300 flex flex-col">
            <div class="p-3 border-b border-gray-200 bg-gray-50">
                <h4 class="font-semibold">Inspector</h4>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-6">
                <div>
                    <h5 class="font-medium mb-3">Current Context</h5>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Mode:</span>
                            <span class="font-mono">BACKTESTING</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Status:</span>
                            <span class="font-mono text-green-600">READY</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Data Quality:</span>
                            <span class="font-mono">98.7%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Compile Status:</span>
                            <span class="font-mono text-green-600">✓ VALID</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h5 class="font-medium mb-3">Last Trade Details</h5>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Side:</span>
                            <span class="font-mono">BUY</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Price:</span>
                            <span class="font-mono">20004.75</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Size:</span>
                            <span class="font-mono">2</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Fill Time:</span>
                            <span class="font-mono">09:31:12.490</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Queue Rank:</span>
                            <span class="font-mono">34 → 0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Slippage:</span>
                            <span class="font-mono">-0.25</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h5 class="font-medium mb-3">Risk Metrics</h5>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Current PnL:</span>
                            <span class="font-mono text-green-600">+$2,847</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Max Drawdown:</span>
                            <span class="font-mono">-$1,240</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Position:</span>
                            <span class="font-mono">+3</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Win Rate:</span>
                            <span class="font-mono">54.8%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Profit Factor:</span>
                            <span class="font-mono">1.62</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Sharpe Ratio:</span>
                            <span class="font-mono">2.1</span>
                        </div>
                    </div>
                </div>

                <div>
                    <h5 class="font-medium mb-3">Order Parameters</h5>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Order Type</label>
                            <select class="w-full border border-gray-300 px-2 py-1 text-sm">
                                <option>LIMIT</option>
                                <option>MARKET</option>
                                <option>STOP</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Time in Force</label>
                            <select class="w-full border border-gray-300 px-2 py-1 text-sm">
                                <option>IOC</option>
                                <option>FOK</option>
                                <option>DAY</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Min Fill Size</label>
                            <input type="number" value="1" class="w-full border border-gray-300 px-2 py-1 text-sm">
                        </div>
                    </div>
                </div>

                <div>
                    <h5 class="font-medium mb-3">Quick Actions</h5>
                    <div class="space-y-2">
                        <button class="w-full text-left px-3 py-2 border border-gray-300 hover:bg-gray-50 text-sm">Export Results</button>
                        <button class="w-full text-left px-3 py-2 border border-gray-300 hover:bg-gray-50 text-sm">Save Strategy</button>
                        <button class="w-full text-left px-3 py-2 border border-gray-300 hover:bg-gray-50 text-sm">Clone Experiment</button>
                        <button class="w-full text-left px-3 py-2 border border-gray-300 hover:bg-gray-50 text-sm">View Full Report</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- @END_COMPONENT: RightInspector -->
    </div>

    <!-- @COMPONENT: ConsoleLog [warnings, compile logs, order messages] -->
    <div class="bg-black text-green-400 border-t border-gray-700 h-32 font-mono text-xs overflow-y-auto">
        <div class="p-2 space-y-1">
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:30:00.123]</span>
                <span class="text-blue-400">[INFO]</span>
                <span>Strategy compilation successful</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:30:00.124]</span>
                <span class="text-blue-400">[INFO]</span>
                <span>Loading historical data: NQ 2025-08 (5 days, 2.3M events)</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:30:00.145]</span>
                <span class="text-blue-400">[INFO]</span>
                <span>Backtesting engine initialized with MBO simulation</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:31:12.482]</span>
                <span class="text-yellow-400">[ORDER]</span>
                <span>SUBMIT: BUY 4@20004.75 (LIMIT, IOC) → Queue rank: 128</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:31:12.486]</span>
                <span class="text-yellow-400">[ORDER]</span>
                <span>UPDATE: Queue rank improved: 128 → 34 (94 contracts ahead canceled)</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:31:12.490]</span>
                <span class="text-green-400">[FILL]</span>
                <span>FILLED: BUY 3@20005.00 (partial fill, slippage: +0.25)</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:31:15.123]</span>
                <span class="text-blue-400">[INFO]</span>
                <span>Position updated: +3 contracts, unrealized PnL: +$1,875</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:32:05.234]</span>
                <span class="text-orange-400">[WARN]</span>
                <span>High latency detected: 45ms (above 2σ threshold)</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:32:18.567]</span>
                <span class="text-yellow-400">[ORDER]</span>
                <span>SUBMIT: SELL 2@20006.25 (LIMIT, DAY) → Queue rank: 67</span>
            </div>
            <div class="flex items-start space-x-2">
                <span class="text-gray-500">[09:32:45.789]</span>
                <span class="text-blue-400">[INFO]</span>
                <span>Running backtest... Progress: 23.4% (Day 1 of 5 complete)</span>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: ConsoleLog -->

    <script>
    // TODO: Implement tab switching functionality
    (function() {
        // Basic tab switching demo
        const tabs = document.querySelectorAll('[role="tab"]');
        // TODO: Add proper tab switching logic here
        
        // TODO: Implement real-time data streaming
        // TODO: Add chart rendering with market data
        // TODO: Implement order book visualization
        // TODO: Add latency simulation controls
        // TODO: Implement strategy compilation and validation
        // TODO: Add export functionality for results
        
        console.log('Backtesting Engine UI initialized');
    })();
    </script>

    <!-- SVG Definitions for Charts -->
    <svg width="0" height="0">
        <defs>
            <pattern id="diagonalHatch" patternUnits="userSpaceOnUse" width="4" height="4">
                <path d="M 0,4 l 4,-4 M -1,1 l 2,-2 M 3,5 l 2,-2" stroke="#e5e5e5" stroke-width="1"/>
            </pattern>
        </defs>
    </svg>
</body>
</html>